<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>exer_alone_3</title>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script>
    	// 입력된 테이블 정보 출력
    	$(document).ready(function(){
    		
    		$.ajax({
    			url : '/WebProject/allUser',
    			dataType : 'json',
    			success : function(result){
    				
    				let uTable = $('<table />').attr('border', '1');
    				uTable.append(addTitle());
    				
    				for(let i = 0; result.length; i++){
    					
    					let uTr = $('<tr id = "uTr'+i+'"/>');
    					let modiBtn = $('<button on = "userModi('+i+')" />').html('수정');
    					let deleteBtn = $('<button on = "userdelete('+i+')" />').html('삭제');
    					
    					uTr.append(
    						$('<td />').append($('<input type = "number" id = "uId">').val(result[i].userId)),
    						$('<td />').append($('<input type = "text" id = "uName">').val(result[i].userName)),
    						$('<td />').append($('<input type = "text" id = "species">').val(result[i].species)),
    						$('<td />').append($('<input type = "text" id = "gender">').val(result[i].gender)),
    						$('<td />').append($('<input type = "number" id = "age">').val(result[i].age)),
    						$('<td />').html(modiBtn),
    						$('<td />').html(deleteBtn)
    					);
    					
    					uTable.append(uTr);
    				}
    				
    				$('#show').append(uTable);
    			},
    			error : function(err){
    				console.log(err);
    			}
    		});
    	});
    	
    	// 테이블 제목
    	function addTitle(){
    		
    		let uTitle = $("<tr />");
    		uTitle.append(
    				$("<th />").html("번호"),
    				$("<th />").html("이름"),
    				$("<th />").html("인종"),
    				$("<th />").html("성별"),
    				$("<th />").html("나이")
    		);
    		return uTitle;
    	};
    	
    	
    	// 기능 1 : 테이블 내용 수정
    	function userModi(index){
    		
    		let data = {
    			"uId" : $("#uId" + index).val(),
    			"uName" : $("#uName" + index).val(),
    			"species" : $("#species" + index).val(),
    			"gender" : $("#gender" + index).val(),
    			"age" : $("#age" + index).val()
    		};
    		
    		$.ajax({
    			url : '/WebProject/modifyUser',
    			type : 'post',
    			data : data,
    			dataType : 'json',
    			success : function(){
    				alert('수정됨.');
    				location.reload();
    			},
    			error : function(err){
    				console.log(err);
    			}
    		});
    	}
    	
    	
    	// 기능 2 : 테이블 tr 및 내용 삭제
    	function userDelete (){
    		
    		let data = { "uId" : $("#uId" + index).val() };
    		let btn = $("#uTr" + index);
    		
    		$.ajax({
    			url : '/WebProject/deleteUser',
    			type : 'post',
    			data : data,
    			success : function(){
    				alert('수정됨.');
    				location.reload();
    			},
    			error : function(err){
    				console.log(err);
    			}
    		});
    	}
    </script>
</head>
<body>
	<form id = "frm" action = "/WebProject/insertUser" method = "get">
    <table border = "1">
        <caption>유저 등록</caption>
        <tr>
            <td>번호</td>
            <td><input type="number" name="userId"></td>
        </tr>
        <tr>
            <td>이름</td>
            <td><input type="text" name="userName"></td>
        </tr>
        <tr>
            <td>인종</td>
            <td><input type="text" name="species"></td>
        </tr>
        <tr>
            <td>성별</td>
            <td>
            	<input type="radio" name="gender" value = "M" checked = "checked">남
            	<input type="radio" name="gender" value = "F">녀
            </td>
        </tr>
        <tr>
            <td>나이</td>
            <td><input type="number" name="age"></td>
        </tr>
        <tr>
            <th colspan="2">
                <input type="submit" value="등록">
                <input type="reset" value="취소">
            </th>
        </tr>
    </table>
    </form>
    <div id = "show"></div>
</body>
</html>